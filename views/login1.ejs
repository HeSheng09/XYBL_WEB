<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>校园霸凌举报系统</title>
    <link rel="shortcut icon">
    <!-- Bootstrap core CSS -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="/stylesheets/signin.css" rel="stylesheet">
    <script src="/javascripts/jquery-3.4.1.min.js"></script>
    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/checkcode.js"></script>
    <script>
        $(function () {
            //验证码
            var show_num = [];
            draw(show_num);

            $("#canvas").on('click', function () {
                draw(show_num);
            })

            $(".btn").on('click', function () {
                var val = $(".input-val").val().toLowerCase();
                var num = show_num.join("");
                if (val != num) {
                    $(".input-val").val('');
                    draw(show_num);
                    $("#errorMsg").html("验证码错误");
                    return false;
                }
            })
            //异步验证账号密码
            $("#loginForm").submit(function () {
                if (checkUsername() && checkPassword()) {
                    $.post("/user/login", $(this).serialize(), function (data) {
                        if (data.flag) {
                            var identi = parseInt($("input[name='identification']:checked").val());
                            switch (identi) {
                                case 0:
                                    location.href = "/get/main";
                                    break;
                                case 1:
                                    location.href = "/test?pageNum=1";
                                    break;
                                case 2:
                                    break;
                            }
                        } else {
                            $("#errorMsg").html("用户名或密码错误");
                            draw(show_num);
                        }
                    });
                }
                return false;
            });

            //正则表达式验证
            $("#password").blur(checkPassword);
            $("#username").blur(checkUsername);
        })

        function checkPassword() {
            var password = $("#password").val();
            var reg_password = /^\w{6,18}$/
            var flag = reg_password.test(password);
            if (flag) {
                //用户名合法
                $("#password").css("border", "");
            } else {
                //用户名非法,加一个红色边框
                $("#password").css("border", "1px solid red");
            }
            return flag;
        }

        function checkUsername() {
            var username = $("#username").val();
            var reg_username = /^\w{13}$/
            var flag = reg_username.test(username);
            if (flag) {
                //用户名合法
                $("#username").css("border", "");
            } else {
                //用户名非法,加一个红色边框
                $("#username").css("border", "1px solid red");
            }
            return flag;
        }
    </script>
</head>
<body class="text-center">
<div class="container-fluid header">
    <div class="page-header ">
        <h1>校园霸凌举报系统
            <small>登录页面</small>
        </h1>
    </div>
</div>
<div class="container">
    <div>
        <form class="form-signin" method="post" id="loginForm">
            <tr>
                <td>
                    <label class="sr-only">用户名</label>
                </td>
                <td>
                    <input type="text" name="username" class="form-control" placeholder="用户名" required=""
                           autofocus="" id="username">
                </td>
            </tr>

            <tr>
                <td>
                    <label class="sr-only">密码</label>
                </td>
                <td>
                    <input type="password" name="password" class="form-control" placeholder="密码"
                           required="" id="password">
                </td>
            </tr>
            <tr>
                <td>
                    <label class="sr-only">验证码</label>
                </td>
                <td>
                    <input type="text" placeholder="请输入验证码（不区分大小写）" class="form-control input-val">
                    <canvas id="canvas" width="100" height="40"></canvas>
                </td>
            </tr>
            <div class="radio mb-3">
                <label>
                    <input type="radio" value="0" name="identification" checked="checked">老师
                </label>
                <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <lable>
                    <input type="radio" value="1" name="identification">学生
                </lable>
                <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <lable>
                    <input type="radio" value="2" name="identification">管理员
                </lable>
            </div>
            <div id="errorMsg" style="color:red;text-align: center"></div>
            <button class="btn btn-lg btn-primary btn-block" type="submit" text="">登录</button>
            <a href="/account/register">没有账号？注册一个</a>
        </form>
    </div>

    <div>
        <p class="mt-5 mb-3 text-muted">© 2019 </p>
    </div>
</div>


</body>
</html>